<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

    <ui:define name="title">Gestion lotes</ui:define>

    <ui:define name="content">

        <!-- INICIO FORMULARIO LOTES REGISTRADOS -->
        <h:form id="lotesRegistrados">
            <p:dataTable value="#{MbLote.lista_lote()}" id="x" var="lote" paginator="true" rows="10" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                <f:facet name="header">
                    Lotes Registrados
                </f:facet>
                <!-- Muestra el correlativo pero se desordena la vista ya no caben las acciones -->
                <!-- <p:column headerText="Correlativo">
                    <h:outputText value="#{MbLote.correlativo}" />
                </p:column> --> 

                <p:column headerText="Nombre Lote">
                    <h:outputText value="#{lote.nombreLote}" />
                </p:column>

                <p:column headerText="Vector">
                    <h:outputText value="#{mbVector.muestra_vector_por_ID(lote.idVector)}" />
                </p:column>
                <p:column headerText="N° muestras">
                    <h:outputText value="#{lote.numMuestras}" />
                </p:column>                
                <p:column headerText="Fecha de creación">
                    <h:outputText value="#{lote.fechaCreacion}">
                        <f:convertDateTime pattern="dd/MM/yyyy" />
                    </h:outputText>
                </p:column> 

                <p:column headerText="Estado">
                    <h:outputText value="#{lote.estatus == 0? 'Inactivo' : 'Activo'}" /> 
                </p:column>

                <p:column headerText="Acciones">
                    <div align="center">
                        <p:commandButton value="Consultar" class="blue-grey-btn" actionListener="#{MbLote.setLoteSeleccionado(lote)}" oncomplete="PF('dialogoConsultar').show();" update="formulario_consultar:dlg_consultar" />
                        <p:spacer height="10" width="10" />
                        <p:commandButton value="Modificar" class="orange-btn" actionListener="#{MbPersona.setPersonaSeleccionada(persona)}" oncomplete="PF('dialogoModificar').show();" update="formulario_modificar:dlgMod" />
                    </div>
                </p:column>
            </p:dataTable>
        </h:form>
        <!-- FIN FORMULARIO ROLES REGISTRADOS -->



        <!-- INICIO FORMULARIO CONSULTAR LOTE -->
        <h:form id="formulario_consultar">
            <p:dialog header="Lote Registrado" widgetVar="dialogoConsultar" id="dlg_consultar" resizable="false" modal="true">
                <p:scrollPanel  style="height: 400px;width: 1000px;">
                    <p:panel header="Datos generales" id="panel_consultar_dgral">
                        <h:panelGrid columns="4" cellpadding="10">
                            <p:column >
                                <h:outputText value="Nombre:"/>
                                <p:spacer height="10" width="10" />
                                <h:outputText value="#{MbLote.loteSeleccionado.nombreLote}" style="font-weight: bold;"/>
                            </p:column>
                            <p:column >
                                <h:outputText value="Vector:"/>
                                <p:spacer height="10" width="10" />
                                <h:outputText value="#{mbVector.muestra_vector_por_ID(MbLote.loteSeleccionado.idVector)}" style="font-weight: bold;"/>
                            </p:column>
                            <p:column >
                                <h:outputText value="N° muestras:"/>
                                <p:spacer height="10" width="10" />
                                <h:outputText value="#{MbLote.loteSeleccionado.numMuestras}" style="font-weight: bold;"/>
                            </p:column>
                        </h:panelGrid>
                        <h:panelGrid columns="4" cellpadding="10">
                            <p:column >
                                <h:outputText value="Fecha de creación:" />
                                <p:spacer height="10" width="10" />
                                <h:outputText  value="#{MbLote.loteSeleccionado.fechaCreacion}" style="font-weight: bold;">
                                    <f:convertDateTime pattern="dd-MM-yyyy" />
                                </h:outputText>
                            </p:column>
                            <p:column >
                                <h:outputText value="Estado:"/>
                                <p:spacer height="10" width="10" />
                                <h:outputText value="#{MbLote.loteSeleccionado.estatus == 1? 'Activo' : 'Inactivo'}" style="font-weight: bold;"/>
                            </p:column>
                            <p:column >
                                <h:outputText value="Usuario responsable:"/>
                                <p:spacer height="10" width="10" />
                                <h:outputText value="XXXFalta" style="font-weight: bold;"/>
                            </p:column>
                        </h:panelGrid>
                    </p:panel>
                    <p:panel header="Datos muestras" id="panel_consultar_dmuestras">
                        <h:panelGrid columns="4" cellpadding="10">
                            <p:dataTable emptyMessage="No se han encontrado registros" var="mu" value="#{mbMuestrasLotes.muestras_por_lote(MbLote.loteSeleccionado.idLote)}">
                                <p:column headerText="codigoMuestra">
                                    <h:outputText value="#{mu.codigoMuestra}" />
                                </p:column>
                                <p:column headerText="Edad">
                                    <h:outputText value="#{mu.edadMuestra}" />
                                </p:column>
                                <p:column headerText="Genero">
                                    <h:outputText value="#{mu.generoMuestra == 'Hembra'? 'Hembra' : 'Macho'}" style="font-weight: bold;"/>
                                </p:column>
                                <p:column headerText="Nombre Científico">
                                    <h:outputText value="#{mu.nomCientifico}" />
                                </p:column>
                                <p:column headerText="Tiene parásito">
                                    <h:outputText value="#{mu.parasito == true? 'Si' : 'No'}" style="font-weight: bold;"/>
                                </p:column>
                            </p:dataTable>
                        </h:panelGrid>
                    </p:panel>
                    <p:panel header="Datos mantenimientos" id="panel_consultar_dmanto">
                        <h:panelGrid columns="4" cellpadding="10">
                            <p:dataTable emptyMessage="No se han encontrado registros" var="ma" value="#{mbMantenimientoLote.lista_mantenimientos_por_lote(MbLote.loteSeleccionado.idLote)}">
                                <p:column headerText="Fecha mantenimiento">
                                    <h:outputText value="#{ma.fechaManto}" />
                                </p:column>
                                <p:column headerText="Fecha próximo mantenimiento">
                                    <h:outputText value="#{ma.fechaProxManto}" />
                                </p:column>
                                <p:column headerText="Mantenimiento completado">
                                    <h:outputText value="#{ma.completadoManto == true? 'Si' : 'No'}" style="font-weight: bold;"/>
                                </p:column>
                                <p:column headerText="Preservante usado">
                                    <h:outputText value="#{MbPreservante.nombre_pres_por_ID(ma.preservante.idPreservante)}" />
                                </p:column>
                            </p:dataTable>
                        </h:panelGrid>
                    </p:panel>
                </p:scrollPanel >
            </p:dialog>
        </h:form>       
        <!-- FIN FORMULARIO CONSULTAR LOTE -->

        <!-- INICIO FORMULARIO MODIFICAR ROL -->
        <h:form id="formulario_modificar">
            <p:dialog header="Modificar" widgetVar="dialogoModificar" id="dlgMod" resizable="false" modal="true">
                <p:panel style="border: none !important;" rendered="#{not empty MbRol.selectedRol}" id="panel_modificar">
                    <p:outputLabel value="Nombre:" />
                    <br/>
                    <p:inputTextarea value="#{MbRol.selectedRol.nomRol}" cols="50" rows="1" maxlength="25">
                        <p:keyFilter regEx="/[a-zA-Z]/i" />
                    </p:inputTextarea>
                    <br/>
                    <br/>
                    <p:outputLabel value="Descripcion" />
                    <br/>
                    <p:inputTextarea value="#{MbRol.selectedRol.descripcion}" maxlength="500" cols="50" autoResize="true">
                        <p:keyFilter regEx="/[a-zA-Z0-9 ]/i" />
                    </p:inputTextarea>
                    <br/>
                    <p:outputLabel value="Estado" />
                    <br/>
                    <p:selectOneMenu value="#{MbRol.selectedRol.estadoRol}">
                        <f:selectItem itemLabel="Activo" itemValue="true"/>
                        <f:selectItem itemLabel="Inactivo" itemValue="false" />
                    </p:selectOneMenu>
                    <br/>                    <br/>
                    <div align="center">
                        <p>
                            <p:commandButton class="secondary-btn" onclick="PF('dialogoModificar').hide();" ajax="true" value="Cancelar" />
                            <p:spacer height="10" width="10" />
                            <p:commandButton class="orange-btn" actionListener="#{MbRol.modificarDialog()}" ajax="true" value="Modificar" update="rolCreacion:mensaje" />
                        </p>
                    </div>
                </p:panel>
            </p:dialog>
        </h:form>
        <!-- FIN FORMULARIO ELIMINAR ROL -->

        <!-- INICIO DIALOGO DEFAULT -->
        <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
            Procesando...
        </p:dialog>
        <!-- FIN DIALOGO DEFAULT -->
        <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
    </ui:define>
</ui:composition>

